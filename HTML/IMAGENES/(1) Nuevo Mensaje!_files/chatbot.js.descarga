"use strict";var Loader=new function(){this.require=function(t,e){this.loadCount=0,this.totalRequired=t.length,this.callback=e;for(var a=0;a<t.length;a++)this.writeScript(t[a])},this.loaded=function(t){this.loadCount++,this.loadCount==this.totalRequired&&"function"==typeof this.callback&&this.callback.call()},this.writeScript=function(t){var e=this,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=t,a.onload=function(t){e.loaded(t)};var n=document.getElementsByTagName("head")[0];n.appendChild(a)}},rulesRegex={email:new RegExp("/w+([.-]?w+)*@w+([.-]?w+)*(.w{2,5})+/","gm"),phone:new RegExp("/[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-s./0-9]*/","gm")},$_help={isInterger:function(t){return/^\+?[0-9][\d]*$/.test(t)},isEmail:function(t){return/\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,5})+/gm.test(t)},isEqual:function(t,e){return JSON.stringify(t)==JSON.stringify(e)},Timer:function(t,e){return setTimeout(e,t)},isPreview:function(t){t=t||null;return!!window._configBot.hasOwnProperty("Preview")&&(null!==t&&window._configBot.Preview==t||!(null!=t||!window._configBot.hasOwnProperty("Preview")))}},BotEventName="Bot"+window._NameBot,Conversation=new function(){var t=[];this.init=function(e){t=e},this.addBot=function(e){t.push({core:"bot",IDDialog:e.idPos,msg:e.question,node:e.node,type:e.type,crm:e.item.crm})},this.addUser=function(e,a){t.push({core:"user",IDDialog:e.idPos,msg:a,node:e.node,type:e.type,crm:e.item.crm})},this.get=function(){return t},this.clear=function(){t=[]}},$store=function(t){this.name=t;var e=localStorage;this.add=function(t){e.setItem(this.name,JSON.stringify(t))},this.get=function(t){var a=e.getItem(this.name),n=JSON.parse(a);return!!n.hasOwnProperty(t)&&n[t]},this.getAll=function(){var t=e.getItem(this.name);return JSON.parse(t)},this.delete=function(){e.removeItem(this.name)},this.clear=function(){e.clear()}},BotDialog=function(t,e,a){$store.call(this,"BCBOT-"+e);var n,i={},o={},s=!1,r=/(lead_msg|custom)/m,c=["quest","politic","email","num","select","calendar"],l=!1,h="initial",u=!1,d={},f={idPos:"",question:"",answers:{},validate:{},userReply:!1,timing:0,node:"main",next:!1,type:"msg",server:{IDLead:0,IDContact:0,IDCompany:0},progress:0,conversion:!1,item:{crm:!1},status:"init",send:!1};this.VERSION="1.1.1",this.statePrev={},this.state=Object.assign({},f),this.loadState=function(){if(this.getAll()&&!$_help.isPreview()){var t=this.getAll();if(!t.hasOwnProperty("version"))return this.delete(),!1;if(t.version!=this.VERSION)return this.delete(),!1;if(Object.keys(t.branchs).length!==Object.keys(o).length)return this.delete(),!1;i=t.dialogs,o=t.branchs,Conversation.init(t.conversation),n=Object.keys(i),u=t.StartIteraction,this.state=t.state,this.statePrev=t.statePrev,this.SetDialogStatus("Loaded")}},this.Save=function(t){var e=t||!1;if(!e&&$_help.isPreview())return!1;var a={conversion:s,conversation:Conversation.get(),version:this.VERSION,dialogs:i,branchs:o,state:this.state,statePrev:this.statePrev,StartIteraction:u};if(e)return a;this.add(a)},this.BotDialog=function(){n=Object.keys(i),this.state.idPos=n[0],this.loadState(),this.CRM()},this.Dialogs=function(t){return i[t]||i},this.CRM=function(){var t={};$.each(i,function(e,a){a.hasOwnProperty("crm")&&"false"!==a.crm&&""!==a.crm&&!1!==a.crm&&"none"!==a.crm&&(t[a.crm]="")}),$.each(o,function(e,a){$.each(a.dialogs,function(){this.hasOwnProperty("crm")&&"false"!==this.crm&&""!==this.crm&&!1!==this.crm&&"none"!==this.crm&&(t[this.crm]="")})}),this.state.answers=$.extend(t,this.state.answers)},this.HasNext=function(){var t=n.length,e=n.indexOf(this.state.idPos)+1;return e<=t&&!l&&(e==t&&(l=!0),n[e])},this.endBranch=function(){var t=!1,e=o[this.state.node].end;return"end"!=e&&(t=o[this.state.node].end),this.switch("main"),"end"!=e?(this.state.idPos=t,l=!1,this.speach()):(this.state.next=t,t)},this.Next=function(){return this.state.next&&!l?(this.state.idPos=this.state.next,this.speach()):l&&"main"!==this.state.node?this.endBranch():void(this.state.next=!1)},this.speach=function(){var t=this.state.idPos,e="main"==this.state.node?i[t]:o[this.state.node].dialogs[t];if(void 0!==e){var a={idPos:t,question:e.value,answers:this.state.answers,userReply:e.userReply,timing:parseInt(e.timing)>0?1e3*parseInt(e.timing):0,validate:e.hasOwnProperty("condition")?e.condition:[],item:e,next:this.HasNext(),type:e.type};this.statePrev=$.extend({},this.state),this.state=$.extend(this.state,a),Conversation.addBot(this.state)}return this.state},this.listen=function(t){var e=t;switch(this.state.type){case"email":var a=t.match(rulesRegex.email);t=a&&a.length>0?a[0]:t;break;case"num":if("contact_phone"==this.state.item.crm){var n=t.match(rulesRegex.phone);t=n&&n.length>0?n[0]:t}}var i=this.rules(t);if(!1===i){if(d={},Conversation.addUser(this.state,e),"select"==this.state.type&&void 0!==this.state.item.branchs){var s=this.state.item.options.indexOf(t),c=this.state.item.branchs,l=Array.isArray(c)?c.length:Object.keys(c).length;c&&s>-1&&l>0&&c[s]&&o.hasOwnProperty(c[s])&&(this.switch(c[s]),console.log("Rama:"+o[c[s]].name))}this.hasStatus("Typing|Timer")&&""!==this.state.answers[this.statePrev.item.crm]?this.state.answers[this.statePrev.item.crm]+=" "+t:"false"!==this.state.item.crm&&!1!==this.state.item.crm&&"none"!=this.state.item.crm&&(r.test(this.state.item.crm)&&this.state.answers[this.state.item.crm].length>0?this.state.answers[this.state.item.crm]+=" "+t:this.state.answers[this.state.item.crm]=t),this.Save()}else d={type:"error",question:i}},this.switch=function(t){switch(this.state.node=t,t){case"main":n=Object.keys(i);break;default:n=Object.keys(o[t].dialogs),console.log(n,o[t].dialogs);var e=o[t].dialogs,a=Object.keys(e).length;if(a>0)l=!1,this.state.next=n[0];else{n=Object.keys(i);var s=o[t].end;this.state.node="main",this.state.next="end"!=s&&s}}},this.hasError=function(){if(Object.keys(d).length>0)return!0},this.error=function(){return d},this.rules=function(t){var e="";return $.each(this.state.validate,function(a,n){switch(n.rule){case"required":if(t.length<1)return e=n.error,!1;break;case"email":if(!$_help.isEmail(t))return e=n.error,!1;break;case"phone":if(isNaN(t)||t.length<7||t.length>25)return e=n.error,!1;break;case"integer":if(!$_help.isInterger(t))return e=n.error,!1;break;case"min_max":if(t.trim().length<n.extra.min||t.trim().length>n.extra.max)return e=n.error,!1}}),""!==e&&e},this.hasWait=function(){return c.indexOf(this.state.type)>=0},this.status=function(t){this.state.status=t,this.Save()},this.hasStatus=function(t){var e=t.split("|"),a=this,n=!1;return $.each(e,function(){this.toLowerCase()==a.state.status.toLowerCase()&&(n=!0)}),n},this.DialogStatus=function(t){return h==t},this.SetDialogStatus=function(t){h=t},this.ClearStore=function(){this.clear()},this.Reset=function(){this.state=Object.assign({},f),this.state.idPos=Object.keys(i)[0],l=!1,this.CRM(),this.SetDialogStatus("initial"),this.delete(),Conversation.clear(),this.StartIteraction(!1)},this.StartIteraction=function(t){if(void 0===t)return u;u=t},this.SetDialogs=function(t){i=t,n=Object.keys(i)},this.SetBranch=function(t){o=t},this.conversion=function(t){if(void 0===t)return s;s=t,this.Save()}},BotEngine=function(){var t=this,e={window:window.parent,iframe:window,document:window.parent.document,documentIframe:window.document},a={DOM:e.documentIframe,launcher:{iframewrap:null,iframe:null,launchewrap:null,btn:null,text:null},chatbot:{header:null,control:null,btn:null,textarea:null,chatarea:null,trademark:null,avatar:null,btnClose:null,btnReset:null,btnDown:null,headerState:null,state:null,extraControl:null},ballot:{container:$("<div/>",{class:"msg-dialog msg-bubble to typing"}).html('<div class="typing_loader"></div>'),avatar:$("<div/>",{class:"msg-avatar"}),msg:$("<div/>",{class:"msg-text"})}},n={Preview:!1,config:{},AutoOpen:!1,$Timers:{BotThinking:2e3,waitUser:6e4,waiterError:2e3}},i={open:BotEventName+":open",init:BotEventName+":init",close:BotEventName+":close",reset:BotEventName+":reset",send:BotEventName+":send",complete:BotEventName+":complete",conversion:BotEventName+":conversion"},o={Dialog:null,waiter:null,webTitle:null};e.iframe._configBot.dialogs=JSON.parse(e.iframe._configBot.dialogs),e.iframe._configBot.branchs=JSON.parse(e.iframe._configBot.branchs),e.iframe._configBot.color=JSON.parse(e.iframe._configBot.color),e.iframe._configBot.translation=JSON.parse(e.iframe._configBot.translation);var s=e.document.title;n.config=e.iframe._configBot;var r={newmsg:!1,state:"close"},c=n.config.ID,l=$.extend({},e.iframe.$metadata),h={googleAnalitycs:{init:function(){if($_help.isPreview())return!1;var t=this;""!==n.config.gapixel&&"false"!==n.config.gapixel&&$.getScript("https://www.googletagmanager.com/gtag/js?id="+n.config.gapixel,function(){var a="function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '"+n.config.gapixel+"');",i=$("<script/>").text(a);$("body",e.documentIframe).append(i),t.event("BlueCaribuView",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Vizualización- Chatbot"})})},event:function(t,e){"function"==typeof gtag&&(gtag("event",t,e),console.log("[Chabot][GA] Evento: "+t))}},facebook:{init:function(){var t,e,a,i,o,s,r,c=this;if($_help.isPreview())return!1;""!==n.config.fbpixel&&"false"!==n.config.fbpixel&&(t=window,e=document,a="script",i="https://connect.facebook.net/en_US/fbevents.js",t.fbq||(o=t.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},t._fbq||(t._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],s=e.createElement(a),s.async=!0,s.src=i,r=e.getElementsByTagName(a)[0],r.parentNode.insertBefore(s,r)),fbq("init",n.config.fbpixel),c.event("BlueCaribuView",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Apertura - Chatbot"}))},event:function(t,e){"function"==typeof fbq&&(fbq("trackCustom",t,e),"BlueCaribuComplete"==t&&console.log("[Facebook] Conversión Registrada!"))}},googleads:{init:function(){if($_help.isPreview())return!1;if(n.config.Settings.googleads.hasOwnProperty("conversion")){var t=n.config.Settings.googleads;$("body",e.documentIframe).append(t.conversion)}},conversion:function(){if($_help.isPreview())return!1;if(!t.conversion()&&n.config.Settings.googleads.hasOwnProperty("conversion")){var a=n.config.Settings.googleads;$("body",e.documentIframe).append(a.event),t.conversion(!0),console.log("[GoogleAds] Conversión Registrada!")}}}},u={Default:function(){var e=parseInt(n.config.trigger);if(t.DialogStatus("Loaded"))return!0;e>0&&(e*=1e3,o.waiter=$_help.Timer(e,function(){a.launcher.btn.click()}))},timer:function(){var e=parseInt(n.config.settings.open.value);if(t.DialogStatus("Loaded"))return!0;e>0&&(e*=1e3,o.waiter=$_help.Timer(e,function(){a.launcher.btn.click()}))},scroll:function(){if(t.DialogStatus("Loaded"))return!0;var i=parseInt(n.config.settings.open.value),o=$(e.document).height(),s=(o*(i/100)).toFixed(2),r=function(){$(e.window).scrollTop()>=s&&!n.AutoOpen&&(n.AutoOpen=!0,a.launcher.btn.click())};$(e.window).scroll(r),$(e.iframe).ready(function(){setTimeout(function(){r()},500)})}},d={style:function(){var t=$("<link/>",{href:"https://fonts.googleapis.com/icon?family=Material+Icons",rel:"stylesheet",type:"text/css"}),a=$("<link/>",{href:n.config.Settings.stylesheet.bot,rel:"stylesheet",type:"text/css"}),i=$("<link/>",{href:n.config.Settings.stylesheet.assets,rel:"stylesheet",type:"text/css"}),o=$("<meta/>",{content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0",name:"viewport"}),s=$("<style/>",{id:"custom",type:"text/css"}),r={theme:n.config.color.header,border:n.config.color.header},c="",l=["#ffffff"],h=["#C4C9CE"],u=l.indexOf(r.theme);u>-1&&(r.border=h[u]),c+="#skeleton-bot .header{ background-color: "+r.theme+";}",c+="#skeleton-bot .body .from{ border-color:  "+r.border+"}",c+="#skeleton-bot .footer #control-area:focus{ border-color: "+r.border+" }",c+="#skeleton-bot .footer #control-send.active{ background: "+r.theme+"; border: solid 1px "+r.border+" }",c+=".option-wrap .option:hover, .option-wrap .link:hover{ border-color:"+r.border+"; color : inherit; background-color:white}",s.text(c),$("head",e.documentIframe).append([o,i,t,a,s])},UI:function(){var t={closed:"<span class='material-icons icon' translate='no'>remove</span>",send:'<span class="material-icons icon" translate="no">send</span>',reload:'<span class="material-icons icon" translate="no">autorenew</span>'},i=$("<div/>",{id:"fix-scroll"}),o=$("<main/>",{id:"skeleton-bot"}),s=$("<section/>",{class:"header"}),r=$("<div/>",{class:"avatar"}).html($("<img/>",{src:n.config.avatar})),l=$("<span/>",{class:"online-pointer"}),h=$("<div/>",{class:"name"}).text(n.config.BotName),u=$("<button/>",{class:"minus",title:"Cerrar la Conversación"}).html(t.closed),d=$("<button/>",{class:"reload-chat",title:"Reiniciar Conversación"}).html(t.reload),f=$("<section/>",{class:"body"}),m=$("<section/>",{class:"footer"}),g=$("<div/>",{class:"controls"}),p=$("<input/>",{id:"control-area",placeholder:n.config.translation.input,disabled:!0}).attr("autocomplete","off"),v=$("<button/>",{id:"control-send"}).html(t.send),b=$("<a/>",{class:"watermark",target:"_blank",href:"https://www.bluecaribu.com/chatbot/lp?utm_source=referral&utm_medium=logo&utm_campaign=chatbot"}),w=$("<div/>",{class:"text"}).text("Creado con "),y=$("<span/>"),C=$("<div/>",{class:"text"});r.append(l),s.append([r,h,d,u]),g.append([p,v]),b.append([w,y]),n.config.Settings.trademark?m.append([g,b]):m.append(g),o.append([s,f,m,C]),i.append(o),$("body",e.documentIframe).append(i),a.chatbot={header:s,control:g,btn:v,textarea:p,chatarea:f,trademark:b,avatar:r,btnReset:d,btnClose:u,extraControl:C};var x=$("#bluecaribu-chatbot-"+c,e.document);a.launcher={iframewrap:$("#chatbot-iframe-"+c,e.document),iframe:$("#bluecaribu-bot-iframe-"+c,e.document),launchewrap:$("#bluecaribu-chatbot-"+c,e.document),btn:$(".btn-launcher",x),text:$(".launcher-wrapper",x)}},colors:function(){var t=tinycolor(n.config.color.header).getBrightness(),e="light";t>=150&&(e="dark"),a.chatbot.header.addClass(e),a.chatbot.btn.addClass(e)},Botmsg:function(e,i){a.ballot.avatar.clone().text(n.config.BotName);var o=a.ballot.msg.clone().html(e||t.state.question);i=i||a.ballot.container.clone();return e||(i.addClass("dialog-"+t.state.idPos),t.status("waiter")),i.removeClass("typing").addClass("ready"),i.empty(),i.append(o),i},Usermsg:function(t){$("<div/>",{class:"msg-avatar"}).text("Yo");var e=$("<div/>",{class:"msg-text"}).text(t),n=a.ballot.container.clone();n.removeClass("typing to").addClass("from ready"),n.empty(),n.append(e),this.print(n)},scrollDown:function(){a.chatbot.chatarea.stop().animate({scrollTop:a.chatbot.chatarea[0].scrollHeight},600)},print:function(t){a.chatbot.chatarea.append(t),this.scrollDown()},newBallot:function(e,i){var o=a.ballot.container.clone();e=e||!1,t.status("Typing"),e?$_help.Timer(n.$Timers.BotThinking,function(){"function"==typeof i&&i(o),d.print(o)}):("function"==typeof i&&i(o),this.print(o))},AutoOpen:function(){if(n.config.hasOwnProperty("settings")&&n.config.settings.hasOwnProperty("open"))switch(n.config.settings.open.type){case"timer":u.timer();break;case"scroll":u.scroll()}else u.Default()},mobile:function(){if(e.iframe.hasOwnProperty("$_helpers")&&e.iframe.$_helpers.isMobile()){var t=$("<link/>",{href:n.config.Settings.stylesheet.mobile,rel:"stylesheet",type:"text/css"});$("head",e.documentIframe).append(t),a.launcher.iframewrap.addClass("mobile-bc-chat"),a.launcher.iframe.contents().find("body").attr("id","mobile");var i=$(".bluecaribu-whatsapp-container."+n.config.position,e.document);0==i.length&&n.config.hasOwnProperty("settings")&&!n.config.settings.message_mobile&&a.launcher.launchewrap.find(".launcher-wrapper").css("display","none")}},ResizePosition:function(){var t=$(".bluecaribu-whatsapp-container."+n.config.position,e.document);t.length>0&&(a.launcher.iframewrap.addClass("chatbot-move-widget-iframe"),a.launcher.launchewrap.addClass("chatbot-move-widget"),a.chatbot.chatarea.addClass("chatbot-move-widget"))},fixResposive:function(){$(e.iframe).on("resize",function(){var t=e.iframe.innerHeight-(a.chatbot.header[0].offsetHeight+a.chatbot.control[0].offsetHeight+50);a.chatbot.chatarea.css({height:t+"px","max-height":t+"px"}),d.scrollDown()})},BotMessageAnnunce:function(){if($_help.isPreview())return!1;var t="(1) Nuevo Mensaje!";o.webTitle=setInterval(function(){if(!r.newmsg||"open"==r.state)return e.document.title=s,a.launcher.btn.hasClass("new")&&a.launcher.btn.removeClass("new"),!1;e.document.title==s?e.document.title=t:e.document.title=s,a.launcher.btn.hasClass("new")||a.launcher.btn.addClass("new")},1e3)}},f={Control:function(e){var n=["quest","email","num"];n.indexOf(t.state.type)>=0&&!1!==t.state.next?(a.chatbot.control.removeClass("disabled"),a.chatbot.textarea.attr("disabled",!1),a.chatbot.btn.attr("disabled",!1),a.chatbot.textarea.focus()):(a.chatbot.control.addClass("disabled"),a.chatbot.textarea.attr("disabled",!0),a.chatbot.btn.attr("disabled",!0)),e||this.TypeMsg()},TypeMsg:function(e){var n=e||t.state.item,i=n.IDDialog,o=n.type,s=$(".dialog-"+i,a.chatbot.chatarea);switch(o){case"select":case"politic":var r=n.hasOwnProperty("options")?n.options.filter(function(t){return""!=t}):[],c=$("<div/>",{class:"option-wrap"}),l=[];r.length>0&&($.each(r,function(t,e){var a=$("<div/>",{class:"option",id:"options-"+o+"-"+t,"data-id":t}).text(e);l.push(a)}),c.append(l),s.last().append(c),d.scrollDown());break;case"links":r=n.links.filter(function(t){return Object.keys(t).length>0}),c=$("<div/>",{class:"option-wrap"}),l=[];r.length>0&&($.each(r,function(t,e){var a="on"==n.target?"_blank":"self";switch(e.key){case"link":var i=$("<a/>",{class:"link",id:"links-"+o+"-"+t,href:e.value,target:a}).html("<i class='material-icons'>link</i> "+e.title);break;case"email":i=$("<a/>",{class:"link",id:"links-"+o+"-"+t,href:"mailto:"+e.value,target:a}).html("<i class='material-icons'>email</i> "+e.title);break;case"tel":i=$("<a/>",{class:"link",id:"links-"+o+"-"+t,href:"tel:"+e.value,target:a}).html("<i class='material-icons'>phone</i> "+e.title);break;case"ws":i=$("<a/>",{class:"link",id:"links-"+o+"-"+t,href:"https://api.whatsapp.com/send?phone="+e.value.replace("+",""),target:a}).html("<i class='material-icons'>sms</i> "+e.title)}l.push(i)}),c.append(l),s.last().append(c),d.scrollDown());break;case"calendar":var h="calendar"==n.calendar.type?"Selecciona una Fecha":"Agenda una Cita";console.log(n.calendar),s.last().append($("<button/>",{class:"button-calendar"}).text(h)),d.scrollDown()}},CalInputProgress:function(){0==t.state.next&&0==t.state.send&&(this.Control(!0),h.googleAnalitycs.event("BlueCaribuComplete",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversacion Completada - Chatbot"}),h.facebook.event("BlueCaribuComplete",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversacion Completada - Chatbot"}),g())},metadata:function(){if($_help.isPreview())return!1;var t=e.iframe.$_helpers;t._getQueryParams(document.location.search);l=$.extend(!0,{},l,t._traffic()),l.browser=t._DetectBrowser(),l.platform=navigator.platform,l.contact="Chatbot"}},m={call:function(t,a=null){var n={detail:a||{},cancelable:!0};e.document.dispatchEvent(new CustomEvent(t,n))},attach:function(t,a=function(t){}){e.document.addEventListener(t,a)},element:function(t,e,a=function(t){}){t.addEventListener(e,a)},UiAttachEvent:function(){a.chatbot.btnClose.click(function(){m.call(i.close)}),a.chatbot.btnReset.click(function(){m.call(i.reset)}),a.chatbot.textarea.on("keyup change",function(t){var e=$(this);e.val().length>0?a.chatbot.btn.addClass("active"):a.chatbot.btn.removeClass("active")}),a.chatbot.textarea.keypress(function(t){var e=t.which||t.keyCode;13==e&&(t.preventDefault(),a.chatbot.btn.click())}),a.chatbot.textarea.focus(function(t){r.newmsg=!1,d.scrollDown()}),a.chatbot.btn.click(function(e){e.preventDefault();var o=$(this),s=a.chatbot.textarea.val().trim();if(o.removeClass("active"),""==s)return!1;if(a.chatbot.textarea.val(""),t.hasStatus("Typing|Timer")){var r=$(".from",a.chatbot.chatarea).last().find(".msg-text");return r.text(r.text()+" "+s),t.listen(s),!1}d.Usermsg(s),0!=t.StartIteraction()||$_help.isPreview()||(t.StartIteraction(!0),h.googleAnalitycs.event("BlueCaribuStart",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversacion Iniciada - Chatbot"}),h.facebook.event("BlueCaribuStart",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversacion Iniciada - Chatbot"})),t.listen(s),t.hasError()?d.newBallot(void 0,function(e){$_help.Timer(n.$Timers.waiterError,function(){d.Botmsg(t.error().question,e),t.status("userReply"),d.scrollDown()})}):(t.Next(),t.state.next?t.Typing(!0):(!$_help.isPreview("Data")&&$_help.isPreview()||f.CalInputProgress(),m.call(i.complete,{UI:a,FACTORY:d})))}),a.chatbot.chatarea.on("click",".option",function(){var e=$(this),n=e.data("id"),i=t.state.item,o=e.closest(".option-wrap"),s=i.hasOwnProperty("options")?i.options.filter(function(t){return""!=t}):[];s.keys();if(void 0!==s[n]){var r=s[n];a.chatbot.textarea.val(r),a.chatbot.btn.click()}o.remove()}),a.chatbot.chatarea.on("click",".button-calendar",function(){$(this);var e=t.state,n=e.item,i=a.chatbot.extraControl,o=$("<div/>",{id:"calendar"}),s=$("<div/>",{id:"range-time"}).html("<div class='no-disponible'> <strong>No hay espacios disponibles</strong> </div>"),r=["dom","lun","mar","mie","jue","vie","sab"],c={};switch(console.log(n),n.calendar.type){case"calendar":break;case"appointment":c={autoSize:!0,minDate:0,beforeShowDay:function(t){var e=t.getDay();return n.calendar.days.indexOf(r[e])>-1?[!0]:[!1]}};var l=n.calendar.time.start.split(":");n.calendar.time.end.split(":");console.log(l),i.append([o,s])}o.datepicker(c),i.addClass("show")})},UiEventsDefault:function(){$(e.document).on(i.close,function(t){r.state="close",a.launcher.launchewrap.removeClass("chatbot-novisible"),t.defaultPrevented||t.hasOwnProperty("isDefaultPrevented")&&t.isDefaultPrevented()||a.launcher.btn.click()}),$(e.document).on(i.reset,function(e){e.defaultPrevented||e.hasOwnProperty("isDefaultPrevented")&&e.isDefaultPrevented()||t.ResetChat()}),$(e.iframe).ready(function(t){a.launcher.launchewrap.css("visibility","visible")}),$(e.document).on(i.init,function(t){console.log("[Bot"+_NameBot+"] Cargado!"),window.hasOwnProperty("launcherShow")&&launcherShow()})},LauncherEvents:function(){a.launcher.btn.click(function(){var t=a.launcher.iframewrap.css("display");a.launcher.text.hide(),"block"==t?(a.launcher.iframewrap.removeClass("iframe-chat-appear").addClass("iframe-chat-exit"),r.state="close"):(a.launcher.iframewrap.addClass("iframe-chat-visible"),a.launcher.iframewrap.removeClass("iframe-chat-exit iframe-chat-exit-complete").addClass("iframe-chat-appear"),r.state="open",a.launcher.launchewrap.addClass("chatbot-novisible"))}),a.launcher.iframewrap.on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(t){var e=$(this);e.hasClass("iframe-chat-exit")?e.addClass("iframe-chat-exit-complete"):(clearTimeout(o.waiter),a.launcher.iframewrap.trigger(i.open))}),a.launcher.iframewrap.one(i.open,function(){t.DialogStatus("Loaded")||t.Typing(),r.state="open",d.scrollDown()}),a.launcher.text.click(function(){var t=$(this);t.hide("slow"),a.launcher.btn.click()})}},g=function(){if(!$_help.isPreview("Data")&&$_help.isPreview())return!0;var a={};$.each(t.state.answers,function(t,e){""!==e&&(a[t]=e)});var o=$.extend({},a),s=e.iframe.paths.chatbot;o.token=n.config.Settings.Account.Token,o.servicio="BOT_"+n.config.ChatID,o.__metadata=l,$.ajax({url:s,crossDomain:!0,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",method:"post",data:o,beforeSend:function(){console.info("["+BotEventName+"] BlueCaribu APP Tecnology : Enviando Datos al CRM")},success:function(e){if(console.info("["+BotEventName+"] BlueCaribu APP Tecnology : Datos Recibidos"),201==e.code)return t.state.send=!0,t.Save(),!1;h.googleAnalitycs.event("BlueCaribuConversion",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversión - Chatbot"}),h.facebook.event("BlueCaribuConversion",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversión - Chatbot"}),t.state.server={IDLead:e.body.IDLead,IDContact:e.body.IDContact,IDCompany:e.body.IDCompany},t.state.send=!0,h.googleads.conversion(),t.Save(),m.call(i.conversion,{state:t.state})},error:function(){}})};this.init=function(){h.googleAnalitycs.init(),h.facebook.init(),h.googleads.init(),f.metadata(),d.style(),d.UI(),d.colors(),d.ResizePosition(),d.mobile(),d.fixResposive(),m.LauncherEvents(),BotDialog.call(t,a,c,null),null!=n.config.branchs&&Object.keys(n.config.branchs).length>0&&t.SetBranch(n.config.branchs),t.SetDialogs(n.config.dialogs),t.BotDialog(),m.UiAttachEvent(),m.UiEventsDefault(),t.DialogStatus("Loaded")?t.ReTyping():t.speach(),d.AutoOpen(),d.BotMessageAnnunce(),m.call(i.init,{UI:a,FACTORY:d})},this.Typing=function(e){d.newBallot(e,function(e){t.status("Timer"),o.Dialog=$_help.Timer(t.state.timing,function(){t.status("Typing");d.Botmsg(!1,e);return t.Save(),f.Control(),1==t.hasWait()?(t.status("UserReply"),t.Save(),r.newmsg=!0,!0):(t.Next(),!1===t.state.next?(t.status("Complete"),t.Save(),f.CalInputProgress(),m.call(i.complete,{UI:a,FACTORY:d}),r.newmsg=!1,!0):void t.Typing())})})},this.ReTyping=function(){var e=Conversation.get(),n=t.state.next,o=t.state.idPos,s=(t.state.answers,e.length-1);t.switch(t.state.node),"main"!=t.state.node&&(t.state.next=n),$.each(e,function(e,n){var c;switch(n.core){case"bot":c=d.Botmsg(n.msg),d.print(c),"links"==n.type&&(c.addClass("dialog-"+n.IDDialog),f.TypeMsg(t.Dialogs(n.IDDialog)),c.removeClass("dialog-"+n.IDDialog));break;case"user":d.Usermsg(n.msg)}if(!(o!=e&&s!=e||o!=n.IDDialog&&s!=n.IDDialog))return!c||"select"!=n.type&&"politic"!=n.type&&"links"!=n.type||c.addClass("dialog-"+t.state.idPos),f.Control(),t.hasWait()&&(r.newmsg=!0),t.hasStatus("waiter|userReply")||!1===t.state.next||t.hasWait()?0==t.state.next&&(r.newmsg=!1,m.call(i.complete,{UI:a,FACTORY:d})):(t.Next(),t.Typing()),f.CalInputProgress(),!1})},this.Empty=function(){clearTimeout(o.Dialog),t.Reset(),a.chatbot.chatarea.empty(),f.Control()},this.ResetChat=function(){clearTimeout(o.Dialog),t.SetDialogs(n.config.dialogs),t.SetBranch(n.config.branchs),t.Reset(),t.speach(),a.chatbot.chatarea.empty(),f.Control(),t.Typing()},this.speak=function(){t.BotDialog(),t.speach(),t.Typing(),d.scrollDown()},this.console=function(){console.log(n.config)},this.config=function(){console.log(n)},this.version=function(){console.log("Version: "+t.VERSION)},this.metadata=function(){console.log(l)},this.download=function(){var e=document.createElement("a"),a=new Date,n=BotEventName+"-"+a.getTime();e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(t.Save(!0)))),e.setAttribute("download",n),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},this.answers=function(){console.log(this.state.answers)},this._facebook=function(){h.facebook.event("BlueCaribuComplete",{event_category:"BOT - "+n.config.BotName+" - "+n.config.ID,event_label:"Conversacion Completada - Chatbot"})}},SCRIPTS=["https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.4.1/tinycolor.min.js","https://code.jquery.com/jquery-2.2.4.min.js","https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"];Loader.require(SCRIPTS,function(){window.parent.hasOwnProperty("BcWidgets")?(window.parent.BcWidgets.chatbot[BotEventName]=new BotEngine,window.parent.BcWidgets.chatbot[BotEventName].init(),window.parent[BotEventName]=window.parent.BcWidgets.chatbot[BotEventName]):(window.parent[BotEventName]=new BotEngine,window.parent[BotEventName].init())});